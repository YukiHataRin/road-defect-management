<div class="card">
    <div class="card-body">
        {% if error %}
            <div class="alert alert-danger">{{ error }}</div>
        {% else %}
            <div class="defect-list">
                {% if defects and defects.data %}
                    {% for defect in defects.data %}
                        <div class="defect-item">
                            <div class="defect-image-container" data-defect-id="{{ defect.id }}">
                                {% if defect.has_image %}
                                    <div class="image-placeholder">
                                        <div class="spinner-border spinner-border-sm text-primary" role="status">
                                            <span class="visually-hidden">載入中...</span>
                                        </div>
                                    </div>
                                    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
                                         data-src="{{ url_for('defects.proxy_image', defect_id=defect.id) }}"
                                         data-defect-id="{{ defect.id }}"
                                         class="defect-image lazy"
                                         alt="{{ defect.defect_type.name }}"
                                         loading="lazy"
                                         onclick="showImagePreview(this.dataset.src)">
                                {% else %}
                                    <div class="no-image" data-defect-id="{{ defect.id }}">
                                        <i class="bi bi-image"></i>
                                        <span>無圖片</span>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="defect-info">
                                <div class="defect-header">
                                    <div class="defect-type">
                                        {% if defect.defect_type.value == 0 %}
                                            <i class="fas fa-grip-lines"></i>
                                        {% elif defect.defect_type.value == 1 %}
                                            <i class="fas fa-grip-lines-vertical"></i>
                                        {% elif defect.defect_type.value == 2 %}
                                            <i class="fas fa-border-all"></i>
                                        {% elif defect.defect_type.value == 3 %}
                                            <i class="far fa-circle"></i>
                                        {% else %}
                                            <i class="fas fa-question-circle"></i>
                                        {% endif %}
                                        {{ defect.defect_type.name }}
                                    </div>
                                    <div class="defect-id">#{{ defect.id }}</div>
                                </div>
                                <div class="defect-severity">
                                    <i class="fas fa-exclamation-triangle" style="color: #FFD700;"></i>
                                    <span>嚴重程度：<span style="color: #333;">{{ defect.severity.name }}</span><span class="severity-dot" style="background-color: {% if defect.severity.value == 0 %}#4CAF50{% elif defect.severity.value == 1 %}#FFC107{% else %}#F44336{% endif %};"></span></span>
                                </div>
                                <div class="defect-location">
                                    <i class="bi bi-geo-alt"></i>
                                    {{ defect.city }} {{ defect.district }} {{ defect.road_section }}
                                </div>
                                <div class="defect-footer">
                                    <div class="defect-time">
                                        <i class="bi bi-clock"></i>
                                        <script>
                                            document.write(new Date('{{ defect.capture_time }}').toLocaleString('zh-TW', {
                                                year: 'numeric',
                                                month: '2-digit',
                                                day: '2-digit',
                                                hour: '2-digit',
                                                minute: '2-digit',
                                                hour12: false
                                            }));
                                        </script>
                                    </div>
                                    <button class="btn btn-sm btn-info" onclick="">
                                        <i class="bi bi-eye"></i> 詳情
                                    </button>
                                </div>
                                <div class="defect-actions" style="display: none;">
                                    <button class="btn btn-sm btn-warning" onclick="editDefect({{ defect.id }})">
                                        <i class="bi bi-pencil"></i> 編輯
                                    </button>
                                    <button class="btn btn-sm btn-success" onclick="updateStatus({{ defect.id }})">
                                        <i class="bi bi-check2"></i> 更新
                                    </button>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="no-data">
                        <i class="bi bi-inbox"></i>
                        <p>沒有找到瑕疵資料</p>
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div> 